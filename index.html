<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Tap2Rich - RichAds</title>
<script src="https://sdk.taddy.pro/web/taddy.min.js" data-pub-id="8c25a78822aed88dfe0e1fa55d807415"></script>
<script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  window.TelegramAdsController = new TelegramAdsController();
  window.TelegramAdsController.initialize({
    pubId: "991750",
    appId: "5124",
  });
</script>

<style>
  /* CSS Styles */
  body{margin:0;padding:0;background:#000;font-family:'Segoe UI',sans-serif;color:#fff;overflow:hidden}
  #top{position:fixed;top:0;left:0;right:0;background:#000;padding:15px;display:flex;justify-content:space-between;align-items:center;z-index:999;box-shadow:0 4px 20px rgba(0,255,255,0.2)}
  #name{color:#0ff;font-weight:bold;font-size:18px}
  #pointBox{background:linear-gradient(135deg,#00ffff,#8a2be2);color:#000;padding:10px 25px;border-radius:30px;font-weight:bold;font-size:17px;box-shadow:0 0 25px #0ff}
  #walletBtn{background:linear-gradient(135deg,#8a2be2,#ff00ff);color:white;padding:12px 28px;border-radius:30px;font-weight:bold;cursor:pointer;border:none;box-shadow:0 0 25px #8a2be2}
  
  #gameArea{display:none}
  #tapArea{width:290px;height:290px;margin:110px auto 30px;position:relative;background:radial-gradient(circle,#00e0ff,#0066ff,#000);border-radius:50%;cursor:pointer;overflow:hidden;box-shadow:0 0 70px #00ffff,0 0 130px #8a2be2;border:8px solid #00ffff;display:flex;flex-direction:column;align-items:center;justify-content:center;animation:glow 3s infinite alternate}
  
  @keyframes glow{from{box-shadow:0 0 70px #00ffff,0 0 130px #8a2be2}to{box-shadow:0 0 100px #00ffff,0 0 180px #8a2be2}}
  
  .tap-main-text{color:#fff;font-size:48px;font-weight:900;letter-spacing:3px;text-shadow:0 0 30px #00ffff}
  .tap-sub-text{color:#fff;font-size:28px;font-weight:900;margin-top:-10px;text-shadow:0 0 25px #8a2be2}
  #tapCount{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:82px;font-weight:900;color:#fff;text-shadow:0 0 40px #00ffff,0 0 80px #8a2be2,0 10px 30px #000}
  
  .plus{position:absolute;font-size:55px;color:#00ffff;font-weight:900;pointer-events:none;animation:fly 1s forwards;text-shadow:0 0 20px #8a2be2}
  @keyframes fly{to{transform:translateY(-200px) scale(0.4);opacity:0}}
  
  #energyBar{width:88%;max-width:380px;height:36px;background:#111;border-radius:18px;margin:20px auto;overflow:hidden;border:3px solid #00ffff;box-shadow:0 0 25px rgba(0,255,255,0.6)}
  #energyFill{height:100%;background:linear-gradient(90deg,#00ffff,#8a2be2);transition:0.4s}
  #energyText{text-align:center;font-weight:bold;color:#00ffff;font-size:19px;text-shadow:0 0 20px #00ffff}
  
  #adBtn{background:linear-gradient(135deg,#8a2be2,#ff00ff);color:white;padding:18px 40px;border-radius:35px;font-weight:bold;margin:30px auto;display:block;width:88%;max-width:380px;font-size:20px;box-shadow:0 0 35px #8a2be2;cursor:pointer;border:none}
  
  #startScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:1000;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}
  #startScreen h1{font-size:58px;background:linear-gradient(135deg,#00ffff,#8a2be2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:900}
  #startScreen p{font-size:24px;color:#888;margin:40px 0}
  #startBtn{background:linear-gradient(135deg,#8a2be2,#ff00ff);color:white;padding:22px 90px;border-radius:50px;font-size:28px;font-weight:bold;border:none;box-shadow:0 0 50px #ff00ff;cursor:pointer}
</style>
</head>

<body>

<div id="top">
  <div id="name">Guest</div>
  <div id="pointBox">Points: <span id="point">0</span></div>
  <button id="walletBtn" onclick="openWallet()">Wallet</button>
</div>

<div id="startScreen">
  <h1>Tap2Rich</h1>
  <p>Tap & Earn Google Play Gift Cards!</p>
  <button id="startBtn" onclick="startGame()">START TAPPING</button>
</div>

<div id="gameArea">
  <div id="tapArea" onclick="tap(event)">
    <div class="tap-main-text">TAP AND</div>
    <div class="tap-sub-text">EARN</div>
    <div id="tapCount">0</div>
  </div>
  <div id="float"></div>
  <div id="energyBar"><div id="energyFill"></div></div>
  <div id="energyText">Energy: <span id="energyNow">10</span>/10<br>
    <small style="color:#888">Daily: <span id="dailyCount">0</span>/3200</small>
  </div>
  <button id="adBtn" onclick="watchAd()">Watch Ad & Recharge Energy</button>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

// Game Logic Variables
const user = Telegram.WebApp.initDataUnsafe.user || {};
const userId = user.id ? user.id.toString() : "guest"+Date.now();
const userName = user.first_name || user.username || "Guest";
document.getElementById("name").textContent = userName;

const POINT_KEY = "point_"+userId;
const DAILY_KEY = "daily_tap_"+userId;

let points = parseInt(localStorage.getItem(POINT_KEY)) || 0;
let energy = 10;
let todayTaps = parseInt(localStorage.getItem(DAILY_KEY)) || 0;
const DAILY_LIMIT = 3200;

// Update UI Function
function update() {
  document.getElementById("point").innerText = points.toLocaleString();
  document.getElementById("tapCount").innerText = points.toLocaleString();
  document.getElementById("energyFill").style.width = (energy/10)*100 + "%";
  document.getElementById("energyNow").innerText = energy;
  document.getElementById("dailyCount").innerText = todayTaps;
}

// ============================================
// ✅ UPDATED WATCH AD FUNCTION (WITH DEBUGGING)
// ============================================
function watchAd() {
  const btn = document.getElementById("adBtn");
  
  if (!window.TelegramAdsController) {
    Telegram.WebApp.showAlert("Ads system not loaded yet! Check internet.");
    return;
  }

  btn.disabled = true;
  btn.innerText = "Checking for Ads...";

  // RichAds Promotion Call
  window.TelegramAdsController.show().then((result) => {
      // ✅ Success: Reward the user
      energy = 10;
      points += 50; 
      localStorage.setItem(POINT_KEY, points);
      update();
      
      Telegram.WebApp.showAlert("Success! Energy Refilled + 50 Points.");
      Telegram.WebApp.HapticFeedback.notificationOccurred("success");

  }).catch((err) => {
      // ❌ ERROR HANDLING - Aapko batayega reason kya hai
      console.error("RichAds Error:", err);
      
      let msg = "Ad failed.";
      
      // Try to read the error reason
      if (err && err.reason) {
          msg = "Error: " + err.reason; // Example: "no_fill", "frequency_cap"
      } else if (typeof err === 'string') {
          msg = "Error: " + err;
      }
      
      if(msg.includes("no_fill") || msg.includes("No Content")) {
          msg = "No Ads available right now. Try later!";
      }

      Telegram.WebApp.showAlert(msg);

  }).finally(() => {
      btn.disabled = false;
      btn.innerText = "Watch Ad & Recharge Energy";
  });
}

function tap(e) {
  if (energy <= 0 || todayTaps >= DAILY_LIMIT) return;
  energy--; points++; todayTaps++;
  localStorage.setItem(POINT_KEY, points);
  localStorage.setItem(DAILY_KEY, todayTaps);
  
  // Plus One Animation
  const p = document.createElement("div"); p.className="plus"; p.innerText="+1";
  p.style.left = (e.clientX || e.touches[0].clientX) + "px";
  p.style.top = (e.clientY || e.touches[0].clientY) + "px";
  document.getElementById("float").appendChild(p);
  setTimeout(() => p.remove(), 1000);
  
  Telegram.WebApp.HapticFeedback.impactOccurred("medium");
  update();
}

function startGame() { 
  document.getElementById("startScreen").style.display="none"; 
  document.getElementById("gameArea").style.display="block"; 
  update(); 
}

function openWallet() {
    Telegram.WebApp.showAlert("Wallet feature coming soon!");
}

// Initial Call
update();
</script>

</body>
</html>

